module {
  hw.module @top_module(in %clk : i1, in %rst : i1, in %in_data : i4, out out_data : i4) attributes {toy.only} {
    %false = hw.constant false
    %clk_0 = llhd.sig name "clk" %false : i1
    %false_1 = hw.constant false
    %rst_2 = llhd.sig name "rst" %false_1 : i1
    %c0_i4 = hw.constant 0 : i4
    %in_data_3 = llhd.sig name "in_data" %c0_i4 : i4
    %c0_i4_4 = hw.constant 0 : i4
    %out_data = llhd.sig %c0_i4_4 : i4
    %c0_i4_5 = hw.constant 0 : i4
    %interconnect1 = llhd.sig %c0_i4_5 : i4
    %c0_i4_6 = hw.constant 0 : i4
    %interconnect2 = llhd.sig %c0_i4_6 : i4
    %c0_i8 = hw.constant 0 : i8
    %interconnect3 = llhd.sig %c0_i8 : i8
    %c0_i8_7 = hw.constant 0 : i8
    %interconnect4 = llhd.sig %c0_i8_7 : i8
    %false_8 = hw.constant false
    %valid = llhd.sig %false_8 : i1
    %false_9 = hw.constant false
    %ready = llhd.sig %false_9 : i1
    %0 = llhd.prb %clk_0 : !hw.inout<i1>
    %1 = llhd.prb %rst_2 : !hw.inout<i1>
    %2 = llhd.prb %in_data_3 : !hw.inout<i4>
    %u1.data_out = hw.instance "u1" @module1(clk: %0: i1, rst: %1: i1, data_in: %2: i4) -> (data_out: i4) {toy.only}
    %3 = llhd.constant_time <0ns, 0d, 1e>
    llhd.drv %interconnect1, %u1.data_out after %3 : !hw.inout<i4>
    %4 = llhd.prb %clk_0 : !hw.inout<i1>
    %5 = llhd.prb %rst_2 : !hw.inout<i1>
    %6 = llhd.prb %interconnect1 : !hw.inout<i4>
    %u2.data_out = hw.instance "u2" @module2(clk: %4: i1, rst: %5: i1, data_in: %6: i4) -> (data_out: i4) {toy.only}
    %7 = llhd.constant_time <0ns, 0d, 1e>
    llhd.drv %interconnect2, %u2.data_out after %7 : !hw.inout<i4>
    %8 = llhd.prb %clk_0 : !hw.inout<i1>
    %9 = llhd.prb %rst_2 : !hw.inout<i1>
    %10 = llhd.prb %valid : !hw.inout<i1>
    %c0_i4_10 = hw.constant 0 : i4
    %11 = llhd.prb %interconnect2 : !hw.inout<i4>
    %12 = comb.concat %c0_i4_10, %11 : i4, i4
    %u3.out_data = hw.instance "u3" @module3(clk: %8: i1, reset: %9: i1, valid: %10: i1, in_data: %12: i8) -> (out_data: i8) {toy.only}
    %13 = llhd.constant_time <0ns, 0d, 1e>
    llhd.drv %interconnect3, %u3.out_data after %13 : !hw.inout<i8>
    %14 = llhd.prb %clk_0 : !hw.inout<i1>
    %15 = llhd.prb %rst_2 : !hw.inout<i1>
    %16 = llhd.prb %valid : !hw.inout<i1>
    %17 = llhd.prb %ready : !hw.inout<i1>
    %18 = llhd.prb %interconnect3 : !hw.inout<i8>
    %u4.out_data, %u4.done = hw.instance "u4" @module4(clk: %14: i1, reset: %15: i1, valid: %16: i1, ready: %17: i1, in_data: %18: i8) -> (out_data: i8, done: i1) {toy.only}
    %19 = llhd.constant_time <0ns, 0d, 1e>
    llhd.drv %interconnect4, %u4.out_data after %19 : !hw.inout<i8>
    %20 = llhd.prb %interconnect4 : !hw.inout<i8>
    %21 = comb.extract %20 from 0 : (i8) -> i4
    %22 = llhd.constant_time <0ns, 0d, 1e>
    llhd.drv %out_data, %21 after %22 : !hw.inout<i4>
    %23 = llhd.constant_time <0ns, 0d, 1e>
    llhd.drv %clk_0, %clk after %23 : !hw.inout<i1>
    %24 = llhd.constant_time <0ns, 0d, 1e>
    llhd.drv %rst_2, %rst after %24 : !hw.inout<i1>
    %25 = llhd.constant_time <0ns, 0d, 1e>
    llhd.drv %in_data_3, %in_data after %25 : !hw.inout<i4>
    %26 = llhd.prb %out_data : !hw.inout<i4>
    hw.output {toy.only} %26 : i4
  }
  hw.module private @module1(in %clk : i1, in %rst : i1, in %data_in : i4, out data_out : i4) attributes {toy.only} {
    %false = hw.constant false
    %clk_0 = llhd.sig name "clk" %false : i1
    %0 = llhd.prb %clk_0 : !hw.inout<i1>
    %false_1 = hw.constant false
    %rst_2 = llhd.sig name "rst" %false_1 : i1
    %1 = llhd.prb %rst_2 : !hw.inout<i1>
    %c0_i4 = hw.constant 0 : i4
    %data_in_3 = llhd.sig name "data_in" %c0_i4 : i4
    %c0_i4_4 = hw.constant 0 : i4
    %data_out = llhd.sig %c0_i4_4 : i4
    llhd.process {
      cf.br ^bb1
    ^bb1:  // 2 preds: ^bb0, ^bb7
      cf.br ^bb2
    ^bb2:  // 2 preds: ^bb1, ^bb3
      %6 = llhd.prb %clk_0 : !hw.inout<i1>
      %7 = llhd.prb %rst_2 : !hw.inout<i1>
      llhd.wait (%0, %1 : i1, i1), ^bb3
    ^bb3:  // pred: ^bb2
      %8 = llhd.prb %clk_0 : !hw.inout<i1>
      %true = hw.constant true
      %9 = comb.xor bin %6, %true : i1
      %10 = comb.and bin %9, %8 : i1
      %11 = llhd.prb %rst_2 : !hw.inout<i1>
      %true_5 = hw.constant true
      %12 = comb.xor bin %7, %true_5 : i1
      %13 = comb.and bin %12, %11 : i1
      %14 = comb.or bin %10, %13 : i1
      cf.cond_br %14, ^bb4, ^bb2
    ^bb4:  // pred: ^bb3
      %15 = llhd.prb %rst_2 : !hw.inout<i1>
      cf.cond_br %15, ^bb5, ^bb6
    ^bb5:  // pred: ^bb4
      %c0_i4_6 = hw.constant 0 : i4
      %c0_i4_7 = hw.constant 0 : i4
      %16 = llhd.constant_time <0ns, 1d, 0e>
      llhd.drv %data_out, %c0_i4_7 after %16 : !hw.inout<i4>
      cf.br ^bb7
    ^bb6:  // pred: ^bb4
      %17 = llhd.prb %data_in_3 : !hw.inout<i4>
      %c0_i28 = hw.constant 0 : i28
      %18 = comb.concat %c0_i28, %17 : i28, i4
      %c1_i32 = hw.constant 1 : i32
      %c1_i32_8 = hw.constant 1 : i32
      %19 = comb.add %18, %c1_i32_8 : i32
      %c3_i4 = hw.constant 3 : i4
      %c0_i28_9 = hw.constant 0 : i28
      %20 = comb.concat %c0_i28_9, %c3_i4 : i28, i4
      %21 = comb.xor %19, %20 : i32
      %22 = comb.extract %21 from 0 : (i32) -> i4
      %23 = llhd.constant_time <0ns, 1d, 0e>
      llhd.drv %data_out, %22 after %23 : !hw.inout<i4>
      cf.br ^bb7
    ^bb7:  // 2 preds: ^bb5, ^bb6
      cf.br ^bb1
    }
    %2 = llhd.constant_time <0ns, 0d, 1e>
    llhd.drv %clk_0, %clk after %2 : !hw.inout<i1>
    %3 = llhd.constant_time <0ns, 0d, 1e>
    llhd.drv %rst_2, %rst after %3 : !hw.inout<i1>
    %4 = llhd.constant_time <0ns, 0d, 1e>
    llhd.drv %data_in_3, %data_in after %4 : !hw.inout<i4>
    %5 = llhd.prb %data_out : !hw.inout<i4>
    hw.output {toy.only} %5 : i4
  }
  hw.module private @module2(in %clk : i1, in %rst : i1, in %data_in : i4, out data_out : i4) attributes {toy.only} {
    %false = hw.constant false
    %clk_0 = llhd.sig name "clk" %false : i1
    %0 = llhd.prb %clk_0 : !hw.inout<i1>
    %false_1 = hw.constant false
    %rst_2 = llhd.sig name "rst" %false_1 : i1
    %1 = llhd.prb %rst_2 : !hw.inout<i1>
    %c0_i4 = hw.constant 0 : i4
    %data_in_3 = llhd.sig name "data_in" %c0_i4 : i4
    %c0_i4_4 = hw.constant 0 : i4
    %data_out = llhd.sig %c0_i4_4 : i4
    llhd.process {
      cf.br ^bb1
    ^bb1:  // 2 preds: ^bb0, ^bb7
      cf.br ^bb2
    ^bb2:  // 2 preds: ^bb1, ^bb3
      %6 = llhd.prb %clk_0 : !hw.inout<i1>
      %7 = llhd.prb %rst_2 : !hw.inout<i1>
      llhd.wait (%0, %1 : i1, i1), ^bb3
    ^bb3:  // pred: ^bb2
      %8 = llhd.prb %clk_0 : !hw.inout<i1>
      %true = hw.constant true
      %9 = comb.xor bin %6, %true : i1
      %10 = comb.and bin %9, %8 : i1
      %11 = llhd.prb %rst_2 : !hw.inout<i1>
      %true_5 = hw.constant true
      %12 = comb.xor bin %7, %true_5 : i1
      %13 = comb.and bin %12, %11 : i1
      %14 = comb.or bin %10, %13 : i1
      cf.cond_br %14, ^bb4, ^bb2
    ^bb4:  // pred: ^bb3
      %15 = llhd.prb %rst_2 : !hw.inout<i1>
      cf.cond_br %15, ^bb5, ^bb6
    ^bb5:  // pred: ^bb4
      %c0_i4_6 = hw.constant 0 : i4
      %c0_i4_7 = hw.constant 0 : i4
      %16 = llhd.constant_time <0ns, 1d, 0e>
      llhd.drv %data_out, %c0_i4_7 after %16 : !hw.inout<i4>
      cf.br ^bb7
    ^bb6:  // pred: ^bb4
      %17 = llhd.prb %data_in_3 : !hw.inout<i4>
      %c1_i32 = hw.constant 1 : i32
      %18 = comb.extract %c1_i32 from 4 : (i32) -> i28
      %c0_i28 = hw.constant 0 : i28
      %19 = comb.icmp eq %18, %c0_i28 : i28
      %20 = comb.extract %c1_i32 from 0 : (i32) -> i4
      %c-1_i4 = hw.constant -1 : i4
      %21 = comb.mux %19, %20, %c-1_i4 : i4
      %22 = comb.shl %17, %21 : i4
      %c1_i4 = hw.constant 1 : i4
      %c1_i4_8 = hw.constant 1 : i4
      %23 = comb.or %22, %c1_i4_8 : i4
      %24 = llhd.constant_time <0ns, 1d, 0e>
      llhd.drv %data_out, %23 after %24 : !hw.inout<i4>
      cf.br ^bb7
    ^bb7:  // 2 preds: ^bb5, ^bb6
      cf.br ^bb1
    }
    %2 = llhd.constant_time <0ns, 0d, 1e>
    llhd.drv %clk_0, %clk after %2 : !hw.inout<i1>
    %3 = llhd.constant_time <0ns, 0d, 1e>
    llhd.drv %rst_2, %rst after %3 : !hw.inout<i1>
    %4 = llhd.constant_time <0ns, 0d, 1e>
    llhd.drv %data_in_3, %data_in after %4 : !hw.inout<i4>
    %5 = llhd.prb %data_out : !hw.inout<i4>
    hw.output {toy.only} %5 : i4
  }
  hw.module private @module3(in %clk : i1, in %reset : i1, in %valid : i1, in %in_data : i8, out out_data : i8) attributes {toy.only} {
    %false = hw.constant false
    %clk_0 = llhd.sig name "clk" %false : i1
    %0 = llhd.prb %clk_0 : !hw.inout<i1>
    %false_1 = hw.constant false
    %reset_2 = llhd.sig name "reset" %false_1 : i1
    %1 = llhd.prb %reset_2 : !hw.inout<i1>
    %false_3 = hw.constant false
    %valid_4 = llhd.sig name "valid" %false_3 : i1
    %c0_i8 = hw.constant 0 : i8
    %in_data_5 = llhd.sig name "in_data" %c0_i8 : i8
    %c0_i8_6 = hw.constant 0 : i8
    %out_data = llhd.sig %c0_i8_6 : i8
    llhd.process {
      cf.br ^bb1
    ^bb1:  // 2 preds: ^bb0, ^bb9
      cf.br ^bb2
    ^bb2:  // 2 preds: ^bb1, ^bb3
      %7 = llhd.prb %clk_0 : !hw.inout<i1>
      %8 = llhd.prb %reset_2 : !hw.inout<i1>
      llhd.wait (%0, %1 : i1, i1), ^bb3
    ^bb3:  // pred: ^bb2
      %9 = llhd.prb %clk_0 : !hw.inout<i1>
      %true = hw.constant true
      %10 = comb.xor bin %7, %true : i1
      %11 = comb.and bin %10, %9 : i1
      %12 = llhd.prb %reset_2 : !hw.inout<i1>
      %true_7 = hw.constant true
      %13 = comb.xor bin %8, %true_7 : i1
      %14 = comb.and bin %13, %12 : i1
      %15 = comb.or bin %11, %14 : i1
      cf.cond_br %15, ^bb4, ^bb2
    ^bb4:  // pred: ^bb3
      %16 = llhd.prb %reset_2 : !hw.inout<i1>
      cf.cond_br %16, ^bb5, ^bb6
    ^bb5:  // pred: ^bb4
      %c0_i8_8 = hw.constant 0 : i8
      %c0_i8_9 = hw.constant 0 : i8
      %17 = llhd.constant_time <0ns, 1d, 0e>
      llhd.drv %out_data, %c0_i8_9 after %17 : !hw.inout<i8>
      cf.br ^bb9
    ^bb6:  // pred: ^bb4
      %18 = llhd.prb %valid_4 : !hw.inout<i1>
      cf.cond_br %18, ^bb7, ^bb8
    ^bb7:  // pred: ^bb6
      %19 = llhd.prb %in_data_5 : !hw.inout<i8>
      %20 = llhd.constant_time <0ns, 1d, 0e>
      llhd.drv %out_data, %19 after %20 : !hw.inout<i8>
      cf.br ^bb8
    ^bb8:  // 2 preds: ^bb6, ^bb7
      cf.br ^bb9
    ^bb9:  // 2 preds: ^bb5, ^bb8
      cf.br ^bb1
    }
    %2 = llhd.constant_time <0ns, 0d, 1e>
    llhd.drv %clk_0, %clk after %2 : !hw.inout<i1>
    %3 = llhd.constant_time <0ns, 0d, 1e>
    llhd.drv %reset_2, %reset after %3 : !hw.inout<i1>
    %4 = llhd.constant_time <0ns, 0d, 1e>
    llhd.drv %valid_4, %valid after %4 : !hw.inout<i1>
    %5 = llhd.constant_time <0ns, 0d, 1e>
    llhd.drv %in_data_5, %in_data after %5 : !hw.inout<i8>
    %6 = llhd.prb %out_data : !hw.inout<i8>
    hw.output {toy.only} %6 : i8
  }
  hw.module private @module4(in %clk : i1, in %reset : i1, in %valid : i1, in %ready : i1, in %in_data : i8, out out_data : i8, out done : i1) attributes {toy.only} {
    %false = hw.constant false
    %clk_0 = llhd.sig name "clk" %false : i1
    %0 = llhd.prb %clk_0 : !hw.inout<i1>
    %false_1 = hw.constant false
    %reset_2 = llhd.sig name "reset" %false_1 : i1
    %1 = llhd.prb %reset_2 : !hw.inout<i1>
    %false_3 = hw.constant false
    %valid_4 = llhd.sig name "valid" %false_3 : i1
    %false_5 = hw.constant false
    %ready_6 = llhd.sig name "ready" %false_5 : i1
    %c0_i8 = hw.constant 0 : i8
    %in_data_7 = llhd.sig name "in_data" %c0_i8 : i8
    %c0_i8_8 = hw.constant 0 : i8
    %out_data = llhd.sig %c0_i8_8 : i8
    %false_9 = hw.constant false
    %done = llhd.sig %false_9 : i1
    llhd.process {
      cf.br ^bb1
    ^bb1:  // 2 preds: ^bb0, ^bb10
      cf.br ^bb2
    ^bb2:  // 2 preds: ^bb1, ^bb3
      %9 = llhd.prb %clk_0 : !hw.inout<i1>
      %10 = llhd.prb %reset_2 : !hw.inout<i1>
      llhd.wait (%0, %1 : i1, i1), ^bb3
    ^bb3:  // pred: ^bb2
      %11 = llhd.prb %clk_0 : !hw.inout<i1>
      %true = hw.constant true
      %12 = comb.xor bin %9, %true : i1
      %13 = comb.and bin %12, %11 : i1
      %14 = llhd.prb %reset_2 : !hw.inout<i1>
      %true_10 = hw.constant true
      %15 = comb.xor bin %10, %true_10 : i1
      %16 = comb.and bin %15, %14 : i1
      %17 = comb.or bin %13, %16 : i1
      cf.cond_br %17, ^bb4, ^bb2
    ^bb4:  // pred: ^bb3
      %18 = llhd.prb %reset_2 : !hw.inout<i1>
      cf.cond_br %18, ^bb5, ^bb6
    ^bb5:  // pred: ^bb4
      %c0_i8_11 = hw.constant 0 : i8
      %c0_i8_12 = hw.constant 0 : i8
      %19 = llhd.constant_time <0ns, 1d, 0e>
      llhd.drv %out_data, %c0_i8_12 after %19 : !hw.inout<i8>
      %false_13 = hw.constant false
      %false_14 = hw.constant false
      %20 = llhd.constant_time <0ns, 1d, 0e>
      llhd.drv %done, %false_14 after %20 : !hw.inout<i1>
      cf.br ^bb10
    ^bb6:  // pred: ^bb4
      %21 = llhd.prb %valid_4 : !hw.inout<i1>
      %22 = llhd.prb %ready_6 : !hw.inout<i1>
      %23 = comb.and %21, %22 : i1
      cf.cond_br %23, ^bb7, ^bb8
    ^bb7:  // pred: ^bb6
      %24 = llhd.prb %in_data_7 : !hw.inout<i8>
      %25 = llhd.constant_time <0ns, 1d, 0e>
      llhd.drv %out_data, %24 after %25 : !hw.inout<i8>
      %true_15 = hw.constant true
      %true_16 = hw.constant true
      %26 = llhd.constant_time <0ns, 1d, 0e>
      llhd.drv %done, %true_16 after %26 : !hw.inout<i1>
      cf.br ^bb9
    ^bb8:  // pred: ^bb6
      %false_17 = hw.constant false
      %false_18 = hw.constant false
      %27 = llhd.constant_time <0ns, 1d, 0e>
      llhd.drv %done, %false_18 after %27 : !hw.inout<i1>
      cf.br ^bb9
    ^bb9:  // 2 preds: ^bb7, ^bb8
      cf.br ^bb10
    ^bb10:  // 2 preds: ^bb5, ^bb9
      cf.br ^bb1
    }
    %2 = llhd.constant_time <0ns, 0d, 1e>
    llhd.drv %clk_0, %clk after %2 : !hw.inout<i1>
    %3 = llhd.constant_time <0ns, 0d, 1e>
    llhd.drv %reset_2, %reset after %3 : !hw.inout<i1>
    %4 = llhd.constant_time <0ns, 0d, 1e>
    llhd.drv %valid_4, %valid after %4 : !hw.inout<i1>
    %5 = llhd.constant_time <0ns, 0d, 1e>
    llhd.drv %ready_6, %ready after %5 : !hw.inout<i1>
    %6 = llhd.constant_time <0ns, 0d, 1e>
    llhd.drv %in_data_7, %in_data after %6 : !hw.inout<i8>
    %7 = llhd.prb %out_data : !hw.inout<i8>
    %8 = llhd.prb %done : !hw.inout<i1>
    hw.output {toy.only} %7, %8 : i8, i1
  }
}

